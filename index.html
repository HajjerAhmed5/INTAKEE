<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>INTAKEE â€” Videos, Podcasts, and Clips</title>
<meta name="description" content="INTAKEE is the all-in-one platform for videos, podcasts, and clips â€” freedom to create, simple to share.">
<link rel="canonical" href="https://intakee.vercel.app/">

<!-- Social -->
<meta property="og:type" content="website">
<meta property="og:title" content="INTAKEE â€” Videos, Podcasts, and Clips">
<meta property="og:description" content="All-in-one platform for videos, podcasts, and clips.">
<meta property="og:url" content="https://intakee.vercel.app/">
<meta property="og:image" content="/og-image.jpg">
<meta name="twitter:card" content="summary_large_image">

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
<link rel="icon" href="/favicon.ico">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<style>
  :root { color-scheme: dark; }
  *{ box-sizing:border-box; }
  body{ margin:0; background:#000; color:#fff; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }

  /* Header */
  header{
    display:flex; align-items:center; gap:12px;
    padding:18px 16px; border-bottom:1px solid #111;
  }
  .brand img{ height:120px; width:auto; border-radius:12px; opacity:.9; filter:drop-shadow(0 0 12px rgba(255,255,255,.06)); }
  .spacer{ flex:1; }
  #searchWrap{ display:flex; margin-left:auto; }
  .search-bar{ display:flex; align-items:center; gap:8px; background:#0c0c0c; border:1px solid #2a2a2a; padding:8px 10px; border-radius:10px; width:420px; max-width:52vw; }
  .search-bar input{ border:none; outline:none; background:transparent; color:#fff; width:100%; }
  .auth{ display:flex; gap:10px; margin-left:12px; }
  button{ padding:9px 14px; border-radius:10px; border:1px solid #2a2a2a; background:#141414; color:#fff; cursor:pointer; }
  button.primary{ background:#1a1a1a; border-color:#3a3a3a; }
  button.ghost{ background:transparent; }
  button:hover{ background:#191919; }
  button[disabled]{ opacity:.6; cursor:not-allowed; }

  /* Layout */
  main{ max-width:1000px; margin:0 auto; padding:16px; padding-bottom:88px; }
  .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  .muted{ color:#b7b7b7; opacity:.85; font-size:.95rem; }
  .card{ background:#0e0e0e; border:1px solid #1a1a1a; border-radius:14px; padding:14px; margin:12px 0; box-shadow:0 4px 18px rgba(0,0,0,.35); }
  input[type="text"], input[type="email"], input[type="password"], select{
    padding:10px 12px; border-radius:10px; border:1px solid #2a2a2a; background:#0c0c0c; color:#fff;
  }
  input[type="file"]{ color:#aaa; }
  textarea{ width:100%; min-height:80px; padding:10px 12px; border-radius:10px; border:1px solid #2a2a2a; background:#0c0c0c; color:#fff; }

  /* Section header + right search */
  .section-head{ display:flex; align-items:center; gap:12px; margin:0 0 6px; }
  .section-search{ display:flex; align-items:center; gap:8px; background:#0c0c0c; border:1px solid #2a2a2a; padding:8px 10px; border-radius:10px; width:340px; max-width:50vw; margin-left:auto; }
  .section-search input{ border:none; outline:none; background:transparent; color:#fff; width:100%; }

  /* Pills */
  .pills{ display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 4px; }
  .pill{ padding:6px 10px; border:1px solid #2a2a2a; border-radius:999px; font-size:.85rem; background:#0f0f0f; cursor:pointer; }
  .pill.active{ background:#151515; border-color:#3a3a3a; color:#fff; }

  /* Bottom nav */
  .bottom-nav{ position:fixed; bottom:0; left:0; right:0; background:#0b0b0b; border-top:1px solid #151515; display:grid; grid-template-columns:repeat(7,1fr); gap:4px; padding:8px 6px; z-index:50; }
  .bottom-nav a{ color:#aaa; text-decoration:none; display:flex; flex-direction:column; align-items:center; gap:4px; font-size:.75rem; padding:6px 4px; border-radius:10px; }
  .bottom-nav a.active, .bottom-nav a:hover{ color:#fff; background:#111; }

  /* -------- PROFILE -------- */
  .profile-banner{
    height:200px; border-radius:14px; border:1px solid #1a1a1a; background:#111 center/cover no-repeat;
    position:relative; overflow:hidden; margin:12px 0;
  }
  .profile-banner::after{
    content:""; position:absolute; inset:0; background:linear-gradient(to bottom, rgba(0,0,0,.0), rgba(0,0,0,.35));
  }
  .profile-banner .add-btn{
    position:absolute; right:10px; bottom:10px;
    width:30px; height:30px; border-radius:50%;
    background:#fff; color:#000; display:flex; align-items:center; justify-content:center;
    font-weight:700; border:none; cursor:pointer;
  }
  .profile-header{
    display:grid; grid-template-columns: 110px 1fr auto; gap:14px; align-items:center;
  }
  .avatar-wrap{ position:relative; width:110px; height:110px; margin-top:-55px; }
  .profile-avatar{
    width:110px; height:110px; border-radius:50%; background:#1a1a1a; object-fit:cover; border:1px solid #262626;
  }
  .avatar-wrap .add-btn{
    position:absolute; right:0; bottom:0;
    width:28px; height:28px; border-radius:50%;
    background:#fff; color:#000; border:none; font-weight:700; cursor:pointer;
  }
  .profile-actions{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
  .stat-row{ display:flex; gap:18px; flex-wrap:wrap; margin-top:8px; }
  .stat-row .muted strong{ color:#fff; }

  .profile-tabs{ display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
  .grid{ margin-top:10px; display:grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:10px; }
  .grid .tile{ background:#0f0f0f; border:1px solid #1a1a1a; border-radius:12px; overflow:hidden; }
  .grid .tile .thumb{ width:100%; aspect-ratio:16/9; background:#111; object-fit:cover; display:block; }
  .grid .tile .meta{ padding:8px 10px; font-size:.9rem; }

  /* -------- SETTINGS bits used here -------- */
  .settings-section{ background:#0e0e0e; border:1px solid #1a1a1a; border-radius:14px; padding:14px; margin:12px 0; }
  .settings-item{ display:flex; align-items:center; justify-content:space-between; padding:10px 0; border-top:1px solid #151515; }
  .settings-item:first-child{ border-top:none; }
  .settings-left{ display:flex; align-items:center; gap:10px; }
  .toggle{ width:42px; height:24px; border-radius:999px; border:1px solid #2a2a2a; background:#141414; position:relative; cursor:pointer; }
  .toggle::after{ content:""; position:absolute; top:2px; left:2px; width:20px; height:20px; border-radius:50%; background:#2b2b2b; transition:transform .15s ease; }
  .toggle[data-on="true"]{ background:#1c1c1c; border-color:#3a3a3a; }
  .toggle[data-on="true"]::after{ transform:translateX(18px); }

  .disclosure{ width:100%; text-align:left; padding:10px 12px; border:1px solid #1a1a1a; border-radius:10px; background:#101010; }
  .disclosure[aria-expanded="true"]{ background:#121212; }
  .disclosure-panel{ margin-top:10px; border:1px solid #1a1a1a; border-radius:10px; padding:12px; background:#0f0f0f; }
  .settings-links a{ color:#ddd; text-decoration:none; display:block; padding:6px 0; }
  .settings-links a:hover{ text-decoration:underline; }
</style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="brand"><img src="logo.png" alt="INTAKEE"></div>
    <div class="spacer"></div>
    <div id="searchWrap" class="search-bar">
      <i class="fa fa-search" style="opacity:.6;"></i>
      <input id="globalSearch" type="text" placeholder="Searchâ€¦" />
    </div>
    <div class="auth">
      <button id="loginBtn" style="display:none">Login / Sign Up</button>
      <button id="logoutBtn" style="display:none;">Logout</button>
    </div>
  </header>

  <main>
    <!-- HOME -->
    <section id="tab-home">
      <div class="row" style="justify-content:space-between;align-items:center;margin-top:8px;">
        <h2 style="margin:0;">Trending</h2>
        <div class="pills">
          <button class="pill" data-filter="all">All</button>
          <button class="pill" data-filter="video">Videos</button>
          <button class="pill" data-filter="podcast">Podcasts</button>
          <button class="pill" data-filter="clip">Clips</button>
          <button class="pill" data-filter="following">Following</button>
          <button class="pill" data-filter="new">Newest</button>
        </div>
      </div>
      <div id="home-feed"></div>
    </section>

    <!-- VIDEOS -->
    <section id="tab-videos" style="display:none;">
      <div class="section-head">
        <h3 style="margin:0;">Videos</h3>
        <div class="section-search" id="videosSearchWrap">
          <i class="fa fa-search" style="opacity:.6;"></i>
          <input id="videosSearch" type="text" placeholder="Search videosâ€¦"/>
        </div>
      </div>
      <div id="videos-feed"></div>
    </section>

    <!-- PODCASTS -->
    <section id="tab-podcast" style="display:none;">
      <div class="section-head">
        <h3 style="margin:0;">Podcasts</h3>
        <div class="section-search" id="podcastSearchWrap">
          <i class="fa fa-search" style="opacity:.6;"></i>
          <input id="podcastSearch" type="text" placeholder="Search podcastsâ€¦"/>
        </div>
      </div>
      <div id="podcast-feed"></div>
    </section>

    <!-- UPLOAD (fixed) -->
    <section id="tab-upload" class="card" style="display:none;">
      <h3 style="margin:0 0 12px;">Upload</h3>
      <div class="row" style="gap:12px;align-items:flex-start;">
        <div style="flex:1;min-width:220px;">
          <label for="uploadType">Choose type</label>
          <select id="uploadType" style="width:100%;margin-top:6px;">
            <option value="video">Video</option>
            <option value="clip">Clip</option>
            <option value="podcast_audio">Podcast (Audio)</option>
            <option value="podcast_video">Podcast (Video)</option>
          </select>
        </div>
        <div style="flex:2;min-width:260px;">
          <label for="postTitle">Title</label>
          <input id="postTitle" type="text" placeholder="Add a title" style="width:100%;margin-top:6px;">
        </div>
      </div>

      <div class="row" style="gap:12px;align-items:flex-start;margin-top:12px;">
        <div style="flex:1;min-width:220px;">
          <label for="thumbFile">Thumbnail (cover image)</label>
          <input id="thumbFile" type="file" accept="image/*" style="width:100%;margin-top:6px;">
        </div>
        <div style="flex:2;min-width:260px;">
          <label for="mediaFile">File</label>
          <input id="mediaFile" type="file" accept="video/*,audio/*" style="width:100%;margin-top:6px;">
        </div>
      </div>

      <label for="postDesc" style="margin-top:12px; display:block;">Description</label>
      <textarea id="postDesc" placeholder="Write a short descriptionâ€¦"></textarea>

      <div class="row" style="margin-top:14px;gap:10px;">
        <button id="uploadSubmit" class="primary">Upload</button>
        <button id="goLiveBtn" class="ghost">Go Live</button>
      </div>
      <p class="muted" style="margin-top:8px;">Processing starts after upload. Youâ€™ll be notified when itâ€™s ready.</p>
    </section>

    <!-- CLIPS -->
    <section id="tab-clips" style="display:none;">
      <div class="section-head">
        <h3 style="margin:0;">Clips</h3>
        <div class="section-search" id="clipsSearchWrap">
          <i class="fa fa-search" style="opacity:.6;"></i>
          <input id="clipsSearch" type="text" placeholder="Search clipsâ€¦"/>
        </div>
      </div>
      <div id="clips-feed"></div>
    </section>

    <!-- PROFILE -->
    <section id="tab-profile" style="display:none;">
      <!-- Banner with + -->
      <div id="profileBanner" class="profile-banner">
        <button id="btnAddBanner" class="add-btn owner-only" title="Change banner" style="display:none;">+</button>
      </div>

      <div class="card">
        <div class="profile-header">
          <div class="avatar-wrap">
            <img id="profile-photo" src="" alt="" class="profile-avatar">
            <button id="btnAddAvatar" class="add-btn owner-only" title="Change photo" style="display:none;">+</button>
          </div>

          <div>
            <h3 id="profile-name" style="margin:0;">Your Name</h3>
            <div id="profile-handle" class="muted">@username</div>
            <div id="bio-view" class="muted" style="margin-top:8px;">Add a short bio to introduce yourself.</div>
            <div id="bio-edit-wrap" style="display:none; margin-top:8px;">
              <textarea id="bio-edit" placeholder="Write your bio..."></textarea>
              <div class="row" style="margin-top:8px;">
                <button id="bio-save" class="primary">Save</button>
                <button id="bio-cancel" class="ghost">Cancel</button>
              </div>
            </div>
            <div class="stat-row">
              <div class="muted"><strong id="stat-posts">0</strong> Posts</div>
              <div class="muted"><strong id="stat-followers">0</strong> Followers</div>
              <div class="muted"><strong id="stat-following">0</strong> Following</div>
              <div class="muted"><strong id="stat-likes">0</strong> Likes</div>
            </div>
          </div>

          <div class="profile-actions">
            <button id="btn-follow" class="primary">Follow</button>
            <button id="btn-share-profile" class="ghost">Share Profile</button>
            <button id="btn-edit-profile" class="ghost owner-only" style="display:none;">Edit Profile</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="profile-tabs">
          <button class="pill active" data-profiletab="all">All</button>
          <button class="pill" data-profiletab="videos">Videos</button>
          <button class="pill" data-profiletab="podcasts">Podcasts</button>
          <button class="pill" data-profiletab="clips">Clips</button>
          <button class="pill" data-profiletab="playlists">Playlists</button>
        </div>
        <div id="profile-grid" class="grid"></div>
        <div id="profile-empty" class="muted" style="margin-top:8px; display:none;">No posts yet.</div>
      </div>

      <!-- Hidden file inputs -->
      <input id="bannerInput" type="file" accept="image/*" hidden>
      <input id="avatarInput" type="file" accept="image/*" hidden>
    </section>

    <!-- SETTINGS (kept as before; already approved) -->
    <section id="tab-settings" style="display:none;">
      <div class="settings-section">
        <h3 style="margin:0 0 8px;">Account</h3>
        <div class="settings-item"><div class="settings-left"><i class="fa fa-user"></i><span>Name, Username, Email</span></div><button class="ghost">Edit</button></div>
        <div class="settings-item"><div class="settings-left"><i class="fa fa-key"></i><span>Change Password</span></div><button class="ghost">Update</button></div>
        <div class="settings-item"><div class="settings-left"><i class="fa fa-trash"></i><span>Delete Account</span></div><button class="ghost">Start</button></div>
        <div class="settings-item"><div class="settings-left"><i class="fa fa-right-from-bracket"></i><span>Logout</span></div><button id="settings-logout" class="ghost">Logout</button></div>
      </div>

      <div class="settings-section">
        <h3 style="margin:0 0 8px;">Privacy & Safety</h3>
        <div class="settings-item"><div class="settings-left"><i class="fa fa-lock"></i><span>Private account</span></div><div class="toggle" id="toggle-private" data-on="false" role="switch" aria-checked="false"></div></div>
        <div class="settings-item"><div class="settings-left"><i class="fa fa-ban"></i><span>Blocked accounts</span></div><button class="ghost">Manage</button></div>
        <div class="settings-item"><div class="settings-left"><i class="fa fa-comments"></i><span>Comments</span></div>
          <select><option>Everyone</option><option>Followers</option><option>No one</option></select>
        </div>
        <div class="settings-item"><div class="settings-left"><i class="fa fa-eye-slash"></i><span>Hide sensitive content</span></div><div class="toggle" id="toggle-sensitive" data-on="false" role="switch" aria-checked="false"></div></div>
        <div class="settings-item"><div class="settings-left"><i class="fa fa-flag"></i><span>Report a problem</span></div><button class="ghost">Report</button></div>
      </div>

      <div class="settings-section">
        <h3 style="margin:0 0 8px;">Notifications</h3>
        <div class="settings-item"><div class="settings-left"><i class="fa fa-user-plus"></i><span>New followers</span></div><div class="toggle" data-on="true" role="switch" aria-checked="true"></div></div>
        <div class="settings-item"><div class="settings-left"><i class="fa fa-thumbs-up"></i><span>Likes & dislikes</span></div><div class="toggle" data-on="true" role="switch" aria-checked="true"></div></div>
        <div class="settings-item"><div class="settings-left"><i class="fa fa-comment-dots"></i><span>Comments & replies</span></div><div class="toggle" data-on="true" role="switch" aria-checked="true"></div></div>
        <div class="settings-item"><div class="settings-left"><i class="fa fa-cloud-arrow-up"></i><span>Upload complete</span></div><div class="toggle" data-on="true" role="switch" aria-checked="true"></div></div>
      </div>

      <div class="settings-section">
        <h3 style="margin:0 0 8px;">Legal & Policy</h3>
        <button id="legalToggle" class="disclosure" aria-expanded="false">View Legal & Policy</button>
        <div id="legalPanel" class="disclosure-panel" hidden>
          <h4 style="margin:0 0 8px;">Content Responsibility Disclaimer</h4>
          <p class="muted" style="margin:0 0 10px;">
            INTAKEE supports freedom of speech, creativity, and open discussion. Users are fully responsible for content they upload or share. INTAKEE does not endorse, verify, or assume legal responsibility for user-generated content. Content that violates laws, promotes violence or harassment, or contains explicit material may be removed.
          </p>
          <h4 style="margin:10px 0 8px;">Privacy Commitment</h4>
          <p class="muted" style="margin:0 0 10px;">
            We do not sell, rent, or share personal data with advertisers or third parties. Personal information is collected only to run core features. We use secure, industry-standard services. Your content remains your property.
          </p>
          <h4 style="margin:10px 0 8px;">Community Guidelines</h4>
          <ul class="muted" style="margin:0 0 10px; padding-left:18px;">
            <li>Follow the law; no threats, hate speech, or harassment.</li>
            <li>No nudity or explicit material.</li>
            <li>No impersonation or deliberate misinformation.</li>
            <li>Repeated or severe violations may lead to removal or suspension.</li>
          </ul>
          <div class="settings-links">
            <a href="#">Community Guidelines</a>
            <a href="#">Terms of Service</a>
            <a href="#">Privacy Policy</a>
            <a href="mailto:intakee2025@gmail.com">Contact: intakee2025@gmail.com</a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Tabs -->
  <nav class="bottom-nav">
    <a href="#home"    data-tab="home" class="active"><i class="fa fa-home"></i><span>Home</span></a>
    <a href="#videos"  data-tab="videos"><i class="fa fa-video"></i><span>Videos</span></a>
    <a href="#podcast" data-tab="podcast"><i class="fa fa-podcast"></i><span>Podcast</span></a>
    <a href="#upload"  data-tab="upload"><i class="fa fa-plus-circle"></i><span>Upload</span></a>
    <a href="#clips"   data-tab="clips"><i class="fa fa-bolt"></i><span>Clips</span></a>
    <a href="#profile" data-tab="profile"><i class="fa fa-user"></i><span>Profile</span></a>
    <a href="#settings"data-tab="settings"><i class="fa fa-gear"></i><span>Settings</span></a>
  </nav>

  <!-- App -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import {
      getFirestore, doc, getDoc, setDoc, updateDoc, collection,
      serverTimestamp, query, orderBy, limit, onSnapshot, where, addDoc
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-storage.js";
    import { firebaseConfig } from "./firebase-config.js";

    /* Init */
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    /* Elements */
    const searchWrap = document.getElementById("searchWrap");
    const globalSearch = document.getElementById("globalSearch");
    const loginBtn  = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const videosSearch = document.getElementById("videosSearch");
    const podcastSearch = document.getElementById("podcastSearch");
    const clipsSearch = document.getElementById("clipsSearch");

    // Upload
    const uploadType = document.getElementById("uploadType");
    const postTitle  = document.getElementById("postTitle");
    const thumbFile  = document.getElementById("thumbFile");
    const mediaFile  = document.getElementById("mediaFile");
    const postDesc   = document.getElementById("postDesc");
    const uploadSubmit = document.getElementById("uploadSubmit");
    const goLiveBtn    = document.getElementById("goLiveBtn");

    // Profile
    const profileBanner = document.getElementById("profileBanner");
    const btnAddBanner  = document.getElementById("btnAddBanner");
    const btnAddAvatar  = document.getElementById("btnAddAvatar");
    const bannerInput   = document.getElementById("bannerInput");
    const avatarInput   = document.getElementById("avatarInput");
    const profilePhoto  = document.getElementById("profile-photo");
    const profileName   = document.getElementById("profile-name");
    const profileHandle = document.getElementById("profile-handle");
    const bioView       = document.getElementById("bio-view");
    const bioEditWrap   = document.getElementById("bio-edit-wrap");
    const bioEdit       = document.getElementById("bio-edit");
    const bioSave       = document.getElementById("bio-save");
    const bioCancel     = document.getElementById("bio-cancel");
    const btnEditProfile= document.getElementById("btn-edit-profile");
    const btnShareProfile= document.getElementById("btn-share-profile");
    const btnFollow     = document.getElementById("btn-follow");
    const profileGrid   = document.getElementById("profile-grid");
    const profileEmpty  = document.getElementById("profile-empty");

    /* Auth */
    logoutBtn.addEventListener("click", () => signOut(auth));
    onAuthStateChanged(auth, async (user) => {
      loginBtn.style.display  = "none";
      logoutBtn.style.display = user ? "inline-block" : "none";

      if (user) {
        const uref = doc(db, "users", user.uid);
        const snap = await getDoc(uref);
        if (!snap.exists()) {
          await setDoc(uref, { uid:user.uid, displayName:user.displayName??"", email:user.email??"", photoURL:user.photoURL??"", createdAt: serverTimestamp() });
        }
        const fresh = (await getDoc(uref)).data() || {};
        profileName.textContent = fresh.displayName || "Your Name";
        profileHandle.textContent = fresh.email ? "@"+fresh.email.split("@")[0] : "@username";
        if (fresh.photoURL) profilePhoto.src = fresh.photoURL;
        if (fresh.bio) bioView.textContent = fresh.bio;
        if (fresh.bannerURL) profileBanner.style.backgroundImage = url('${fresh.bannerURL}');

        // Show owner-only controls
        document.querySelectorAll('.owner-only').forEach(el => el.style.display = "");
        btnFollow.style.display = "none";

        loadMyPosts(user.uid);
      } else {
        // Hide owner-only controls when not logged in
        document.querySelectorAll('.owner-only').forEach(el => el.style.display = "none");
        btnFollow.style.display = "";
        profileGrid.innerHTML = "";
        profileEmpty.style.display = "";
      }
    });

    /* Helpers */
    function escapeHtml(s=""){ return s.replace(/[&<>\"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }
    function fmtTime(ts){ try{const t=ts?.toDate?ts.toDate():(ts instanceof Date?ts:null); if(!t)return""; return t.toLocaleString([], {month:"short", day:"numeric", hour:"2-digit", minute:"2-digit"});}catch{return"";} }
    function match(p, term){ if(!term) return true; const t=term.toLowerCase(); return ((p.text||"").toLowerCase().includes(t) || (p.title||"").toLowerCase().includes(t)); }

    /* Feeds */
    const homeFeed   = document.getElementById("home-feed");
    const videosFeed = document.getElementById("videos-feed");
    const podcastFeed= document.getElementById("podcast-feed");
    const clipsFeed  = document.getElementById("clips-feed");

    function renderCardFromDoc(d){
      const p=d.data();
      const el=document.createElement("article"); el.className="card";
      const kind=p.kind || p.type || "";
      const label=(kind==="video"||kind==="podcast_video")?"VIDEO"
        :(kind==="podcast_audio"||kind==="audio")?"PODCAST"
        :(kind==="clip")?"CLIP"
        :(kind==="image")?"IMAGE":"";
      const header=<div style="display:flex;justify-content:space-between;align-items:center;">
        <div><strong>${escapeHtml(p.user||"Anon")}</strong> <span class="muted">Â· ${fmtTime(p.createdAt)}</span></div>
        ${label?<span class="muted" style="border:1px solid #2a2a2a;padding:2px 8px;border-radius:999px;font-size:.75rem;">${label}</span>:""}
      </div>;
      let media="";
      const url = p.mediaUrl || p.fileUrl || "";
      if(url){
        if(kind==="video"||kind==="podcast_video") media=<video src="${url}" controls playsinline style="width:100%;border-radius:10px;margin-top:8px;"></video>;
        else if(kind==="podcast_audio"||kind==="audio") media=<audio src="${url}" controls style="width:100%;margin-top:8px;"></audio>;
        else if(kind==="image") media=<img src="${url}" alt="" style="width:100%;border-radius:10px;margin-top:8px;">;
        else media = <a href="${url}" target="_blank" rel="noopener">Open file</a>;
      }
      const text = p.text || p.title || "";
      el.innerHTML = header + (text?<div style="margin-top:6px;">${escapeHtml(text)}</div>:"") + media;
      return el;
    }

    let docs = [];
    const PAGE_SIZE = 40;
    const qMain = query(collection(db,"posts"), orderBy("createdAt","desc"), limit(PAGE_SIZE));
    onSnapshot(qMain, (snap)=>{ docs = snap.docs; draw(); });

    let homeTerm="", videosTerm="", podcastTerm="", clipsTerm="";
    globalSearch?.addEventListener('input', e=>{ homeTerm    = e.target.value.trim(); draw(); });
    videosSearch?.addEventListener('input', e=>{ videosTerm  = e.target.value.trim(); draw(); });
    podcastSearch?.addEventListener('input',e=>{ podcastTerm = e.target.value.trim(); draw(); });
    clipsSearch?.addEventListener('input', e=>{ clipsTerm    = e.target.value.trim(); draw(); });

    function draw(){
      const mediaKinds = new Set(["video","clip","podcast_audio","podcast_video","audio","image"]);
      const trending = docs.filter(d => mediaKinds.has((d.data().kind||d.data().type)) && match(d.data(), homeTerm));
      homeFeed.innerHTML = trending.length ? "" : '<div class="muted" style="text-align:center;margin-top:40px;">No trending content yet. Check back soon.</div>';
      trending.forEach(d=>homeFeed.appendChild(renderCardFromDoc(d)));

      const vids = docs.filter(d => (d.data().kind||d.data().type)==="video" && match(d.data(), videosTerm));
      videosFeed.innerHTML = vids.length?"":'<div class="muted card">No videos yet.</div>'; vids.forEach(d=>videosFeed.appendChild(renderCardFromDoc(d)));

      const pods = docs.filter(d => ["podcast_audio","podcast_video","audio"].includes(d.data().kind||d.data().type) && match(d.data(), podcastTerm));
      podcastFeed.innerHTML = pods.length?"":'<div class="muted card">No podcasts yet.</div>'; pods.forEach(d=>podcastFeed.appendChild(renderCardFromDoc(d)));

      const cls = docs.filter(d => (d.data().kind||d.data().type)==="clip" && match(d.data(), clipsTerm));
      clipsFeed.innerHTML = cls.length?"":'<div class="muted card">No clips yet.</div>'; cls.forEach(d=>clipsFeed.appendChild(renderCardFromDoc(d)));
    }

    /* Tabs */
    const links = Array.from(document.querySelectorAll('.bottom-nav a'));
    const sections = {
      home:document.getElementById('tab-home'),
      videos:document.getElementById('tab-videos'),
      podcast:document.getElementById('tab-podcast'),
      upload:document.getElementById('tab-upload'),
      clips:document.getElementById('tab-clips'),
      profile:document.getElementById('tab-profile'),
      settings:document.getElementById('tab-settings')
    };
    function setTab(key){
      Object.entries(sections).forEach(([k,el])=> el.style.display = (k===key)?'':'none');
      links.forEach(a=>a.classList.toggle('active', a.dataset.tab===key));
      // Header search only on Home
      searchWrap.style.display = (key==="home") ? "flex" : "none";
      window.scrollTo({top:0,behavior:'smooth'});
    }
    function applyHash(){ const key=(location.hash||"#home").slice(1); setTab(key); }
    links.forEach(a=>a.addEventListener('click',e=>{ e.preventDefault(); location.hash = a.getAttribute('href'); }));
    window.addEventListener('hashchange', applyHash);
    applyHash();

    /* -------- Profile: bio edit -------- */
    document.getElementById("btn-edit-profile")?.addEventListener('click', ()=>{
      bioEdit.value = bioView.textContent || "";
      bioView.style.display = "none";
      bioEditWrap.style.display = "";
    });
    bioCancel?.addEventListener('click', ()=>{
      bioEditWrap.style.display = "none";
      bioView.style.display = "";
    });
    bioSave?.addEventListener('click', async ()=>{
      const user = auth.currentUser; if(!user) return alert("Sign in to edit profile.");
      const bio = (bioEdit.value||"").trim();
      await updateDoc(doc(db,"users",user.uid), { bio });
      bioView.textContent = bio || "Add a short bio to introduce yourself.";
      bioEditWrap.style.display = "none";
      bioView.style.display = "";
    });

    /* -------- Profile: share/follow placeholders -------- */
    btnShareProfile?.addEventListener('click', async ()=>{
      const url = location.origin + location.pathname + "#profile";
      try{ await navigator.clipboard.writeText(url); alert("Profile link copied."); }catch{ prompt("Copy profile link:", url); }
    });
    btnFollow?.addEventListener('click', ()=> alert("Follow feature coming later."));

    /* -------- Profile: banner/avatar upload via + buttons -------- */
    btnAddBanner?.addEventListener('click', ()=> bannerInput.click());
    btnAddAvatar?.addEventListener('click', ()=> avatarInput.click());

    bannerInput?.addEventListener('change', async (e)=>{
      const file=e.target.files?.[0]; if(!file) return;
      const user=auth.currentUser; if(!user) return alert("Sign in to change banner.");
      const path=users/${user.uid}/banner/${Date.now()}-${file.name};
      const r=ref(storage, path); await uploadBytes(r,file); const url=await getDownloadURL(r);
      await updateDoc(doc(db,"users",user.uid), { bannerURL:url });
      profileBanner.style.backgroundImage = url('${url}');
    });

    avatarInput?.addEventListener('change', async (e)=>{
      const file=e.target.files?.[0]; if(!file) return;
      const user=auth.currentUser; if(!user) return alert("Sign in to change photo.");
      const path=users/${user.uid}/avatar/${Date.now()}-${file.name};
      const r=ref(storage, path); await uploadBytes(r,file); const url=await getDownloadURL(r);
      await updateDoc(doc(db,"users",user.uid), { photoURL:url });
      profilePhoto.src = url;
    });

    /* -------- Profile: load user posts into grid -------- */
    function tileForPost(p){
      const tile=document.createElement('div'); tile.className='tile';
      let media="";
      const url=p.mediaUrl || p.fileUrl || "";
      const kind=p.kind||p.type||"";
      if(url){
        if(kind==="image"){ media=<img class="thumb" src="${url}" alt="">; }
        else if(kind==="video"||kind==="podcast_video"){ media=<video class="thumb" src="${url}" muted playsinline></video>; }
        else if(kind==="clip"){ media=<video class="thumb" src="${url}" muted playsinline loop></video>; }
        else if(kind==="audio"||kind==="podcast_audio"){ media=<div class="thumb" style="display:flex;align-items:center;justify-content:center;">AUDIO</div>; }
        else { media=<div class="thumb"></div>; }
      } else { media=<div class="thumb"></div>; }
      const title=escapeHtml((p.text||p.title||"Untitled").slice(0,80));
      tile.innerHTML=${media}<div class="meta">${title}</div>;
      return tile;
    }

    function loadMyPosts(uid){
      const qMine = query(collection(db,"posts"), where("ownerId","==",uid), orderBy("createdAt","desc"), limit(60));
      onSnapshot(qMine, (snap)=>{
        const list=snap.docs.map(d=>d.data());
        profileGrid.innerHTML="";
        if(!list.length){ profileEmpty.style.display=""; document.getElementById("stat-posts").textContent="0"; return; }
        profileEmpty.style.display="none";
        list.forEach(p=> profileGrid.appendChild(tileForPost(p)));
        document.getElementById("stat-posts").textContent=String(list.length);
      });
    }

    /* -------- Upload: save to Storage + Firestore -------- */
    uploadSubmit?.addEventListener('click', async ()=>{
      const user=auth.currentUser; if(!user){ alert("Sign in to upload."); return; }
      const type = uploadType.value;
      const title = (postTitle.value||"").trim();
      const desc  = (postDesc.value||"").trim();
      const media = mediaFile.files?.[0];
      const thumb = thumbFile.files?.[0];
      if(!media){ alert("Choose a file to upload."); return; }
      if(!title){ alert("Add a title."); return; }

      uploadSubmit.disabled=true;

      try{
        const ts = Date.now();
        // media
        const mediaPath = uploads/${user.uid}/${ts}_${media.name};
        const mRef = ref(storage, mediaPath);
        await uploadBytes(mRef, media);
        const mediaUrl = await getDownloadURL(mRef);

        // thumbnail (optional)
        let thumbUrl = "";
        if(thumb){
          const tPath = thumbnails/${user.uid}/${ts}_${thumb.name};
          const tRef = ref(storage, tPath);
          await uploadBytes(tRef, thumb);
          thumbUrl = await getDownloadURL(tRef);
        }

        await addDoc(collection(db,"posts"), {
          ownerId: user.uid,
          user: user.displayName || (user.email? user.email.split("@")[0] : "User"),
          kind: type, type, title, text:title, description: desc,
          mediaUrl, thumbUrl,
          likeCount: 0, commentCount: 0,
          createdAt: serverTimestamp()
        });

        alert("Upload complete.");
        postTitle.value=""; postDesc.value=""; mediaFile.value=""; thumbFile.value="";
      }catch(err){
        console.error(err); alert(err?.message || "Upload failed.");
      }finally{
        uploadSubmit.disabled=false;
      }
    });

    goLiveBtn?.addEventListener('click', ()=> alert("Go Live will be added later."));

    /* Settings toggles (visual only) */
    document.querySelectorAll('.toggle').forEach(t=>{
      t.addEventListener('click', ()=>{
        const on = t.getAttribute('data-on') === 'true';
        t.setAttribute('data-on', on ? 'false' : 'true');
        t.setAttribute('aria-checked', on ? 'false' : 'true');
      });
    });

    const legalToggle = document.getElementById("legalToggle");
    const legalPanel  = document.getElementById("legalPanel");
    legalToggle?.addEventListener('click', ()=>{
      const expanded = legalToggle.getAttribute('aria-expanded') === 'true';
      legalToggle.setAttribute('aria-expanded', expanded ? 'false' : 'true');
      legalPanel.hidden = expanded;
    });
  </script>
</body>
<!-- ðŸ”¹ AUTH CONTROLS -->
<div data-anon-only>
  <button onclick="document.getElementById('auth-modal').showModal()">Sign in / Create Account</button>
</div>

<div data-authed-only style="display:none;">
  Signed in as <strong data-user-name></strong>
  <button id="logout-btn">Log out</button>
</div>

<!-- ðŸ”¹ AUTH MODAL -->
<dialog id="auth-modal">
  <form method="dialog" style="text-align:right">
    <button>âœ•</button>
  </form>

  <h3>Create account</h3>
  <form id="signup-form">
    <input name="displayName" type="text" placeholder="Display name (optional)" />
    <input name="email" type="email" placeholder="Email" required />
    <input name="password" type="password" placeholder="Password (min 6)" required />
    <button type="submit">Sign up</button>
  </form>

  <hr />

  <h3>Sign in</h3>
  <form id="login-form">
    <input name="email" type="email" placeholder="Email" required />
    <input name="password" type="password" placeholder="Password" required />
    <button type="submit">Sign in</button>
  </form>
</dialog>

<!-- ðŸ”¹ JS LINKS -->
<script type="module" src="./js/firebase-init.js"></script>
<script type="module" src="./js/auth.js"></script>
<script src="./script.js"></script> <!-- main app logic, including upload
</html>
