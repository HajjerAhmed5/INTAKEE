<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>INTAKEE — Videos, Podcasts, and Clips</title>
  <meta name="description" content="INTAKEE is the all-in-one platform for videos, podcasts, and clips — freedom to create, simple to share.">
  <link rel="canonical" href="https://intakee.vercel.app/">
  <meta property="og:type" content="website">
  <meta property="og:title" content="INTAKEE — Videos, Podcasts, and Clips">
  <meta property="og:description" content="All-in-one platform for videos, podcasts, and clips.">
  <meta property="og:url" content="https://intakee.vercel.app/">
  <meta property="og:image" content="/og-image.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- ===== HEADER ===== -->
  <header>
    <div class="brand"><img src="logo.png" alt="INTAKEE"></div>
    <div class="spacer"></div>
    <div id="searchWrap" class="search-bar">
      <i class="fa fa-search" style="opacity:.6;"></i>
      <input id="globalSearch" type="text" placeholder="Search…" />
    </div>
    <div class="auth">
      <button id="openAuth">Login / Sign Up</button>
      <button id="btnSignOut" style="display:none;">Logout</button>
      <span id="whoami" class="muted" style="margin-left:8px;"></span>
    </div>
  </header>

  <!-- ===== MAIN CONTENT ===== -->
  <main>

    <!-- HOME (Trending feed like YouTube) -->
    <section id="tab-home">
      <div class="row space-between">
        <h2>Trending</h2>
        <div class="pills">
          <button class="pill active" data-filter="all">All</button>
          <button class="pill" data-filter="video">Videos</button>
          <button class="pill" data-filter="podcast">Podcasts</button>
          <button class="pill" data-filter="clip">Clips</button>
          <button class="pill" data-filter="following">Following</button>
          <button class="pill" data-filter="new">Newest</button>
        </div>
      </div>
      <div id="home-feed" class="feed-grid"><!-- TODO: populate trending feed here --></div>
    </section>

    <!-- VIDEOS (YouTube-style stacked feed) -->
    <section id="tab-videos" style="display:none;">
      <div class="section-head">
        <h3>Videos</h3>
        <div class="section-search">
          <i class="fa fa-search"></i>
          <input id="videosSearch" type="text" placeholder="Search videos…">
        </div>
      </div>
      <div id="videos-feed" class="feed-grid"><!-- TODO: render video cards here --></div>
    </section>

    <!-- PODCASTS (Apple-Music style list + mini-player support) -->
    <section id="tab-podcast" style="display:none;">
      <div class="section-head">
        <h3>Podcasts</h3>
        <div class="section-search">
          <i class="fa fa-search"></i>
          <input id="podcastSearch" type="text" placeholder="Search podcasts…">
        </div>
      </div>
      <div id="podcast-feed" class="podcast-list"><!-- TODO: render podcast rows here --></div>
    </section>

    <!-- UPLOAD (Creators can post unlimited content) -->
    <section id="tab-upload" class="card" style="display:none;">
      <h3>Upload</h3>
      <div class="upload-form">
        <label>Choose type</label>
        <select id="uploadTypeSelect">
          <option value="video">Video</option>
          <option value="clip">Clip</option>
          <option value="podcast-audio">Podcast (Audio)</option>
          <option value="podcast-video">Podcast (Video)</option>
        </select>

        <label>Title</label>
        <input id="uploadTitleInput" type="text" placeholder="Add a title">

        <label>Thumbnail (cover image)</label>
        <input id="uploadThumbInput" type="file" accept="image/*">

        <label>File</label>
        <input id="uploadFileInput" type="file" accept="video/*,audio/*">

        <p class="muted small">Processing starts after upload. You’ll be notified when it’s ready.</p>

        <div class="row">
          <button id="btnUpload" class="primary">Upload</button>
          <button id="goLiveBtn" class="ghost">Go Live</button>
        </div>
      </div>
      <!-- TODO: Wire Firebase upload logic -->
    </section>

    <!-- CLIPS (TikTok-style vertical feed) -->
    <section id="tab-clips" style="display:none;">
      <div class="section-head">
        <h3>Clips</h3>
        <div class="section-search">
          <i class="fa fa-search"></i>
          <input id="clipsSearch" type="text" placeholder="Search clips…">
        </div>
      </div>
      <div id="clips-feed" class="clip-feed"><!-- TODO: render full-screen clip cards --></div>
    </section>

    <!-- PROFILE (Clean banner + avatar + grid) -->
    <section id="tab-profile" style="display:none;">
      <div id="profileBanner" class="profile-banner">
        <button id="btnAddBanner" class="add-btn owner-only" title="Change banner" style="display:none;">+</button>
      </div>

      <div class="card">
        <div class="profile-header">
          <div class="avatar-wrap">
            <img id="profile-photo" src="" alt="" class="profile-avatar">
            <button id="btnAddAvatar" class="add-btn owner-only" title="Change photo" style="display:none;">+</button>
          </div>

          <div>
            <h3 id="profile-name">Your Name</h3>
            <div id="profile-handle" class="muted">@username</div>
            <p id="bio-view" class="muted">Add a short bio to introduce yourself.</p>

            <div id="bio-edit-wrap" style="display:none;">
              <input id="profileNameInput" type="text" placeholder="Your name">
              <textarea id="profileBioInput" placeholder="Write your bio..."></textarea>
              <div class="row">
                <label class="ghost">Profile Photo <input id="profilePhotoInput" type="file" accept="image/*"></label>
                <label class="ghost">Banner <input id="profileBannerInput" type="file" accept="image/*"></label>
                <button id="btnSaveProfile" class="primary">Save Profile</button>
                <button id="bio-cancel" class="ghost">Cancel</button>
              </div>
            </div>

            <div class="stat-row">
              <span><strong id="stat-posts">0</strong> Posts</span>
              <span><strong id="stat-followers">0</strong> Followers</span>
              <span><strong id="stat-following">0</strong> Following</span>
              <span><strong id="stat-likes">0</strong> Likes</span>
            </div>
          </div>

          <div class="profile-actions">
            <button id="btn-follow" class="primary">Follow</button>
            <button id="btn-share-profile" class="ghost">Share</button>
            <button id="btn-edit-profile" class="ghost owner-only" style="display:none;">Edit Profile</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="profile-tabs">
          <button class="pill active" data-profiletab="all">All</button>
          <button class="pill" data-profiletab="videos">Videos</button>
          <button class="pill" data-profiletab="podcasts">Podcasts</button>
          <button class="pill" data-profiletab="clips">Clips</button>
          <button class="pill" data-profiletab="playlists">Playlists</button>
        </div>
        <div id="profile-grid" class="grid"></div>
        <div id="profile-empty" class="muted" style="display:none;">No posts yet.</div>
      </div>

      <input id="bannerInput" type="file" accept="image/*" hidden>
      <input id="avatarInput" type="file" accept="image/*" hidden>
    </section>

    <!-- SETTINGS (Privacy & policy) -->
    <section id="tab-settings" style="display:none;">
      <div class="settings-section">
        <h3>Account</h3>
        <div class="settings-item"><div><i class="fa fa-user"></i> Name / Email</div><button class="ghost">Edit</button></div>
        <div class="settings-item"><div><i class="fa fa-key"></i> Change Password</div><button class="ghost">Update</button></div>
        <div class="settings-item"><div><i class="fa fa-trash"></i> Delete Account</div><button class="ghost">Start</button></div>
      </div>

      <div class="settings-section">
        <h3>Privacy & Safety</h3>
        <div class="settings-item"><span>Private account</span><div class="toggle" id="toggle-private" data-on="false"></div></div>
        <div class="settings-item"><span>Uploads</span><div class="toggle" id="toggle-uploads" data-on="true"></div></div>
        <div class="settings-item"><span>Likes</span><div class="toggle" id="toggle-likes" data-on="true"></div></div>
        <div class="settings-item"><span>Saved</span><div class="toggle" id="toggle-saved" data-on="true"></div></div>
        <div class="settings-item"><span>Playlists</span><div class="toggle" id="toggle-playlists" data-on="true"></div></div>
      </div>

      <div class="settings-section">
        <h3>Legal & Policy</h3>
        <p class="muted small">
          INTAKEE supports freedom of speech and creative expression. Users are responsible for their own content.
        </p>
        <a href="#" class="muted">Community Guidelines</a><br>
        <a href="#" class="muted">Terms of Service</a><br>
        <a href="#" class="muted">Privacy Policy</a><br>
        <a href="mailto:intakee2025@gmail.com" class="muted">Contact: intakee2025@gmail.com</a>
      </div>
    </section>
  </main>

  <!-- ===== MINI PLAYER (Apple Music–style) ===== -->
  <div id="mini-player" class="mini-player" hidden>
    <div class="mp-left">
      <div class="mp-art" id="mp-art"></div>
      <div class="mp-meta">
        <div id="mp-title" class="mp-title">—</div>
        <div id="mp-sub" class="mp-sub muted small">—</div>
      </div>
    </div>
    <div class="mp-controls">
      <button id="mp-prev" class="icon-btn" title="Previous"><i class="fa fa-backward-step"></i></button>
      <button id="mp-play" class="icon-btn" title="Play/Pause"><i class="fa fa-play"></i></button>
      <button id="mp-next" class="icon-btn" title="Next"><i class="fa fa-forward-step"></i></button>
    </div>
    <div class="mp-right">
      <div class="mp-time muted small"><span id="mp-cur">0:00</span> / <span id="mp-dur">0:00</span></div>
      <button id="mp-close" class="icon-btn" title="Close"><i class="fa fa-xmark"></i></button>
    </div>
    <!-- Hidden native audio element -->
    <audio id="mp-audio" preload="metadata"></audio>
  </div>

  <!-- ===== BOTTOM NAV ===== -->
  <nav class="bottom-nav">
    <a href="#home"    data-tab="home" class="active"><i class="fa fa-home"></i><span>Home</span></a>
    <a href="#videos"  data-tab="videos"><i class="fa fa-video"></i><span>Videos</span></a>
    <a href="#podcast" data-tab="podcast"><i class="fa fa-podcast"></i><span>Podcast</span></a>
    <a href="#upload"  data-tab="upload"><i class="fa fa-plus-circle"></i><span>Upload</span></a>
    <a href="#clips"   data-tab="clips"><i class="fa fa-bolt"></i><span>Clips</span></a>
    <a href="#profile" data-tab="profile"><i class="fa fa-user"></i><span>Profile</span></a>
    <a href="#settings"data-tab="settings"><i class="fa fa-gear"></i><span>Settings</span></a>
  </nav>

  <!-- ===== AUTH MODAL ===== -->
  <dialog id="authDialog">
    <form method="dialog" style="text-align:right; margin:0 0 8px;">
      <button aria-label="Close">✕</button>
    </form>

    <h3 style="margin:0 0 8px;">Create account</h3>
    <form id="authSignUpForm" style="display:grid; gap:8px;">
      <input id="signUpName" type="text" placeholder="Display name (optional)" />
      <input id="signUpEmail" type="email" placeholder="Email" required />
      <input id="signUpPassword" type="password" placeholder="Password (min 6)" required />
      <button type="submit" class="primary">Sign up</button>
    </form>

    <hr style="border-color:#1a1a1a; margin:12px 0;" />

    <h3 style="margin:0 0 8px;">Sign in</h3>
    <form id="authSignInForm" style="display:grid; gap:8px;">
      <input id="signInEmail" type="email" placeholder="Email" required />
      <input id="signInPassword" type="password" placeholder="Password" required />
      <button type="submit">Sign in</button>
    </form>
  </dialog>

  <!-- ===== CORE SHELL SCRIPTS (placeholders you’ll wire to Firebase) ===== -->
  <script>
    // ---------- Tab Router (hash-based) ----------
    (function initRouter(){
      const links = Array.from(document.querySelectorAll('.bottom-nav a'));
      const sections = {
        home:     document.getElementById('tab-home'),
        videos:   document.getElementById('tab-videos'),
        podcast:  document.getElementById('tab-podcast'),
        upload:   document.getElementById('tab-upload'),
        clips:    document.getElementById('tab-clips'),
        profile:  document.getElementById('tab-profile'),
        settings: document.getElementById('tab-settings')
      };
      const searchWrap = document.getElementById('searchWrap');

      function setTab(key){
        Object.entries(sections).forEach(([k,el]) => el.style.display = (k === key) ? '' : 'none');
        links.forEach(a => a.classList.toggle('active', a.dataset.tab === key));
        if (searchWrap) searchWrap.style.display = (key === 'home') ? 'flex' : 'none';
        window.scrollTo({ top: 0, behavior: 'instant' });
      }
      function applyHash(){
        const key = (location.hash || '#home').slice(1);
        setTab(sections[key] ? key : 'home');
      }
      links.forEach(a => a.addEventListener('click', (e) => {
        e.preventDefault(); location.hash = a.getAttribute('href');
      }));
      window.addEventListener('hashchange', applyHash);
      applyHash();
    })();

    // ---------- Auth header updater (listen for your script.js events) ----------
    function applyHeaderAuth(user) {
      const openBtn = document.getElementById('openAuth');
      const outBtn  = document.getElementById('btnSignOut');
      const whoami  = document.getElementById('whoami');
      const loggedIn = !!user;
      if (openBtn) openBtn.style.display = loggedIn ? 'none' : '';
      if (outBtn)  outBtn.style.display  = loggedIn ? '' : 'none';
      whoami && (whoami.textContent = loggedIn
        ? (user.displayName ? `${user.displayName} (${user.email||''})` : (user.email||''))
        : '');
    }
    document.addEventListener('intakee:auth', (e) => applyHeaderAuth(e.detail?.user ?? null));
    document.getElementById('openAuth')?.addEventListener('click', () => {
      document.getElementById('authDialog')?.showModal();
    });

    // ---------- MINI-PLAYER (Podcast audio across tabs) ----------
    // TODO: In your Firebase code, call window.playPodcast({url, title, subtitle, cover})
    (function initMiniPlayer(){
      const wrap = document.getElementById('mini-player');
      const art  = document.getElementById('mp-art');
      const tEl  = document.getElementById('mp-title');
      const sEl  = document.getElementById('mp-sub');
      const cur  = document.getElementById('mp-cur');
      const dur  = document.getElementById('mp-dur');
      const audio= document.getElementById('mp-audio');
      const btnP = document.getElementById('mp-play');
      const btnX = document.getElementById('mp-close');
      const btnPrev = document.getElementById('mp-prev');
      const btnNext = document.getElementById('mp-next');

      let ticking = null;
      function fmt(sec){ if(!isFinite(sec)) return '0:00';
        const m=Math.floor(sec/60), s=Math.floor(sec%60).toString().padStart(2,'0'); return `${m}:${s}`; }

      function syncTime(){
        cur.textContent = fmt(audio.currentTime);
        dur.textContent = fmt(audio.duration || 0);
        if (!audio.paused) ticking = requestAnimationFrame(syncTime);
      }

      btnP.addEventListener('click', ()=> audio.paused ? audio.play() : audio.pause());
      btnX.addEventListener('click', ()=> { audio.pause(); wrap.hidden = true; });
      btnPrev.addEventListener('click', ()=>{/* optional: queue support */});
      btnNext.addEventListener('click', ()=>{/* optional: queue support */});
      audio.addEventListener('play', ()=>{
        btnP.innerHTML = '<i class="fa fa-pause"></i>';
        cancelAnimationFrame(ticking); ticking = requestAnimationFrame(syncTime);
      });
      audio.addEventListener('pause', ()=> { btnP.innerHTML = '<i class="fa fa-play"></i>'; cancelAnimationFrame(ticking); });
      audio.addEventListener('loadedmetadata', ()=> { dur.textContent = fmt(audio.duration||0); });

      // Expose starter API for your Firebase renderers
      window.playPodcast = ({ url, title, subtitle, cover })=>{
        // Auto-pause any video/clip currently playing — your video code should listen too.
        document.querySelectorAll('video').forEach(v=>{ try{ v.pause(); }catch{} });

        wrap.hidden = false;
        tEl.textContent = title || 'Untitled';
        sEl.textContent = subtitle || '';
        art.style.backgroundImage = cover ? `url(${cover})` : 'none';
        audio.src = url; audio.play().catch(()=>{ /* autoplay blocked until user gesture */ });
      };
    })();

    // ---------- FEED RENDERING PLACEHOLDERS ----------
    // TODO: Replace these with real Firebase-powered renderers in script.js

    // Videos (YouTube-style cards)
    window.renderVideoCard = function(post){
      const card = document.createElement('article');
      card.className = 'video-card card';
      card.innerHTML = `
        <div class="thumb-16x9">
          <img src="${post.thumbnailUrl || ''}" alt="">
          <video src="${post.mediaUrl || ''}" preload="metadata" muted playsinline></video>
        </div>
        <div class="meta">
          <h4 class="title">${post.title || 'Untitled'}</h4>
          <div class="sub muted small">${post.creatorName || 'Unknown'} • ${post.views || 0} views</div>
        </div>`;
      // TODO: Hover preview logic & click → watch view
      return card;
    };

    // Podcasts (Apple-Music rows; click → mini-player)
    window.renderPodcastRow = function(post){
      const row = document.createElement('div');
      row.className = 'podcast-row card';
      row.innerHTML = `
        <div class="pod-art"><img src="${post.coverUrl || post.thumbnailUrl || ''}" alt=""></div>
        <div class="pod-main">
          <div class="pod-title">${post.title || 'Episode'}</div>
          <div class="muted small">${post.showName || ''}</div>
        </div>
        <div class="pod-cta">
          <button class="primary play">Play</button>
        </div>`;
      row.querySelector('.play').addEventListener('click', ()=>{
        window.playPodcast({
          url: post.mediaUrl,
          title: post.title,
          subtitle: post.showName || (post.creatorName||''),
          cover: post.coverUrl || post.thumbnailUrl || ''
        });
      });
      return row;
    };

    // Clips (TikTok-style full screen items)
    window.renderClipFullScreen = function(post){
      const wrap = document.createElement('div');
      wrap.className = 'clip-card';
      wrap.innerHTML = `
        <video class="clip-video" src="${post.mediaUrl||''}" playsinline loop></video>
        <div class="clip-rail">
          <button class="icon-btn"><i class="fa fa-heart"></i><span>${post.likeCount||0}</span></button>
          <button class="icon-btn"><i class="fa fa-comment"></i><span>${post.commentCount||0}</span></button>
          <button class="icon-btn"><i class="fa fa-bookmark"></i></button>
          <button class="icon-btn"><i class="fa fa-share"></i></button>
        </div>
        <div class="clip-caption">
          <div class="muted small">@${post.creatorHandle || 'user'}</div>
          <div class="text">${post.title || ''}</div>
        </div>`;
      // Auto-play when visible; pause when not
      const vid = wrap.querySelector('.clip-video');
      const io = new IntersectionObserver((ents)=>{
        ents.forEach(e=>{
          if (e.isIntersecting && e.intersectionRatio > 0.6) {
            // pause all others
            document.querySelectorAll('.clip-video').forEach(v=>{ if(v!==vid) try{v.pause()}catch{} });
            vid.play().catch(()=>{});
          } else {
            try{ vid.pause(); }catch{}
          }
        });
      }, { threshold:[0,0.6,1]});
      io.observe(wrap);
      return wrap;
    };

    // ---------- SIMPLE HELPERS ----------
    window.qs  = (s,sc)=> (sc||document).querySelector(s);
    window.qsa = (s,sc)=> Array.from((sc||document).querySelectorAll(s));
  </script>

  <!-- Your main app logic (keep using your existing file) -->
  <!-- TODO: In script.js, you will fetch Firestore docs and append nodes returned by the render* functions above -->
  <script type="module" src="script.js?v=11"></script>
</body>
  <!-- Auth triggers (top-right) -->
<button id="open-auth">Login / Sign Up</button>
<button id="signout-btn" style="display:none">Sign out</button>

<!-- Auth Modal -->
<div id="auth-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.45); backdrop-filter:blur(2px); z-index:9999;">
  <div class="auth-card" style="max-width:380px; margin:8vh auto; background:#111; color:#fff; border:1px solid #222; border-radius:14px; padding:18px;">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 style="margin:0;">Welcome to INTAKEE</h3>
      <button id="close-auth" style="font-size:20px; background:none; border:none; color:#aaa; cursor:pointer;">×</button>
    </div>

    <div style="display:flex; gap:8px; margin:14px 0;">
      <button class="tab active" data-tab="signin">Sign In</button>
      <button class="tab" data-tab="signup">Create Account</button>
    </div>

    <!-- Sign In -->
    <form id="signin-form" class="tab-panel" data-panel="signin">
      <input id="signin-email" type="email" placeholder="Email" required style="width:100%;margin:6px 0;">
      <input id="signin-password" type="password" placeholder="Password" required style="width:100%;margin:6px 0;">
      <button id="signin-submit" type="submit" style="width:100%;margin-top:8px;">Sign in</button>
      <p id="signin-error" class="err" style="color:#f66; min-height:1.2em;"></p>
    </form>

    <!-- Sign Up -->
    <form id="signup-form" class="tab-panel" data-panel="signup" style="display:none;">
      <input id="signup-name" type="text" placeholder="Full name" required style="width:100%;margin:6px 0;">
      <input id="signup-username" type="text" placeholder="Username (min 3 chars)" minlength="3" required style="width:100%;margin:6px 0;">
      <input id="signup-email" type="email" placeholder="Email" required style="width:100%;margin:6px 0;">
      <input id="signup-password" type="password" placeholder="Password" required style="width:100%;margin:6px 0;">
      <button id="signup-submit" type="submit" style="width:100%;margin-top:8px;">Create account</button>
      <p id="signup-error" class="err" style="color:#f66; min-height:1.2em;"></p>
    </form>
  </div>
</div>

<!-- Load your app JS as a module -->
<script type="module" src="./script.js"></script>
</html>
