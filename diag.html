<!doctype html><meta charset="utf-8">
<title>INTAKEE â€¢ Firebase Diag</title>
<h1>Firebase Diagnostic</h1>
<button id="login">Google Sign-In</button>
<button id="logout">Sign Out</button>
<pre id="log" style="white-space:pre-wrap;border:1px solid #444;padding:8px"></pre>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
  import { firebaseConfig } from "./firebase-config.js";

  const log = (m)=>{ document.getElementById("log").textContent += m + "\n"; console.log(m); };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getFirestore(app);

  onAuthStateChanged(auth, u => log("auth state: " + (u ? u.uid : "signed-out")));

  document.getElementById("login").onclick = () =>
    signInWithPopup(auth, new GoogleAuthProvider()).catch(e => log("login error: " + e.message));

  document.getElementById("logout").onclick = () =>
    signOut(auth).catch(e => log("logout error: " + e.message));

  (async ()=>{
    try {
      await setDoc(doc(db, "ping", "vercel"), { at: Date.now() });
      const s = await getDoc(doc(db, "ping", "vercel"));
      log("firestore exists: " + s.exists());
      if (s.exists()) log("firestore data: " + JSON.stringify(s.data()));
    } catch (e) { log("firestore error: " + e.message); }
  })();
</script>
